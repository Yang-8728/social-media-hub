#!/usr/bin/env python3
"""
æµ‹è¯•Bç«™ä¸Šä¼ å™¨åŸå§‹é…ç½®æ–‡ä»¶
"""
from src.platforms.bilibili.uploader import BilibiliUploader
import time

def test_original_profile():
    """æµ‹è¯•ä½¿ç”¨åŸå§‹é…ç½®æ–‡ä»¶çš„ä¸Šä¼ å™¨"""
    print('=== æµ‹è¯•åŸå§‹é…ç½®æ–‡ä»¶çš„Bç«™ä¸Šä¼ å™¨ ===')
    
    try:
        uploader = BilibiliUploader('ai_vanvan')
        print(f'é…ç½®æ–‡ä»¶è·¯å¾„: {uploader.profile_path}')
        
        driver, wait = uploader._init_browser()
        print('âœ… æµè§ˆå™¨åˆå§‹åŒ–æˆåŠŸ!')
        
        print('ğŸŒ å¯¼èˆªåˆ°Bç«™...')
        driver.get('https://www.bilibili.com')
        time.sleep(8)
        
        print(f'ğŸ“„ é¡µé¢æ ‡é¢˜: {driver.title}')
        
        # æ£€æŸ¥ç™»å½•çŠ¶æ€
        page_source = driver.page_source
        if 'ç™»å½•' in page_source and ('ç”¨æˆ·ä¸­å¿ƒ' not in page_source and 'ä¸ªäººä¸­å¿ƒ' not in page_source):
            print('âŒ ä»ä¸ºæœªç™»å½•çŠ¶æ€')
        elif 'ç”¨æˆ·ä¸­å¿ƒ' in page_source or 'ä¸ªäººä¸­å¿ƒ' in page_source or 'æŠ•ç¨¿' in page_source:
            print('âœ… å·²ç™»å½•çŠ¶æ€ - æ£€æµ‹åˆ°ç”¨æˆ·åŠŸèƒ½')
        else:
            print('âš ï¸ ç™»å½•çŠ¶æ€ä¸æ˜ç¡®ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥é¡µé¢å†…å®¹...')
            # æ£€æŸ¥æ˜¯å¦æœ‰ç”¨æˆ·åæˆ–å¤´åƒ
            if 'avatar' in page_source.lower() or 'å¤´åƒ' in page_source:
                print('âœ… å¯èƒ½å·²ç™»å½• - æ£€æµ‹åˆ°å¤´åƒå…ƒç´ ')
            else:
                print('âŒ å¯èƒ½æœªç™»å½•')
        
        print('ğŸ” ä¿æŒæµè§ˆå™¨å¼€å¯15ç§’ä¾›æ£€æŸ¥...')
        time.sleep(15)
        driver.quit()
        print('âœ… æµ‹è¯•å®Œæˆ')
        
        return True
        
    except Exception as e:
        print(f'âŒ æµ‹è¯•å¤±è´¥: {e}')
        import traceback
        traceback.print_exc()
        return False

if __name__ == "__main__":
    test_original_profile()
